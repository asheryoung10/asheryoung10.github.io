<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Maze Search Visualizer</title>
<style>
  body {
    background: #0b0c10;
    color: #c5c6c7;
    font-family: 'Courier New', monospace;
    text-align: center;
    margin: 0;
    padding: 20px;
  }

  h1 {
    color: #66fcf1;
    margin-bottom: 10px;
  }

  .controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 15px;
  }

  .file-box, .algo-box, .order-box {
    margin: 10px;
  }

  select, button, input[type="file"] {
    background: #1f2833;
    color: #c5c6c7;
    border: 1px solid #45a29e;
    border-radius: 4px;
    padding: 5px 10px;
    cursor: pointer;
  }

  select:hover, button:hover {
    background: #45a29e;
    color: #0b0c10;
  }

  canvas {
    background: #1f2833;
    border: 2px solid #45a29e;
    display: block;
    margin: 20px auto;
  }

  .direction-grid {
    display: grid;
    grid-template-columns: 50px 50px 50px;
    grid-template-rows: 50px 50px 50px;
    gap: 5px;
    justify-content: center;
  }

  .dir-btn {
    background: #1f2833;
    color: #66fcf1;
    border: 1px solid #45a29e;
    border-radius: 6px;
    font-size: 20px;
    cursor: pointer;
    position: relative;
  }

  .dir-btn:hover {
    background: #45a29e;
    color: #0b0c10;
  }

  .dir-order {
    position: absolute;
    bottom: 2px;
    right: 4px;
    font-size: 12px;
    color: #ffdf6c;
  }

  #status {
    margin-top: 10px;
    color: #fff;
  }
</style>
</head>
<body>

<h1>Maze Search Visualizer</h1>

<div class="controls">
  <div class="file-box">
    <input type="file" id="fileInput" accept=".txt">
    <button id="loadDefault">Load Default Maze</button>
  </div>

  <div class="algo-box">
    <label>Algorithm:</label>
    <select id="algo">
      <option value="dfs">DFS</option>
      <option value="bfs">BFS</option>
    </select>
  </div>

  <div class="order-box">
    <label>Neighbor Order:</label>
    <div class="direction-grid">
      <div></div>
      <button class="dir-btn" data-dir="U">↑<span class="dir-order"></span></button>
      <div></div>
      <button class="dir-btn" data-dir="L">←<span class="dir-order"></span></button>
      <div></div>
      <button class="dir-btn" data-dir="R">→<span class="dir-order"></span></button>
      <div></div>
      <button class="dir-btn" data-dir="D">↓<span class="dir-order"></span></button>
      <div></div>
    </div>
  </div>

  <button id="runBtn">Run Search</button>
</div>

<canvas id="mazeCanvas"></canvas>
<p id="status"></p>

<script>
const canvas = document.getElementById('mazeCanvas');
const ctx = canvas.getContext('2d');
const cellSize = 18;
let maze = [], width = 0, height = 0, start = null, goals = [];

const defaultMazeText = `37 37
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
X       X X X           X   X     X X
X XXXXXXX X XXX X XXX XXX XXXXXXX X X
X       X       X X     X     X X   X
XXXXX XXXXX XXX X X X XXX XXXXX X XXX
X   X X X X   X X X X   X X   X X   X
X XXX X X X XXX XXXXX XXX X XXX XXX X
X       X     X   X   X     X X X   X
XXX XXXXXXXXX XXXXXXX XXX XXX X X X X
X             X       X X   X     X X
X X XXXXX X XXX X X XXX X XXX XXX X X
X X X     X X X X X     X   X X X X X
X X X XXXXXXX X XXXXXXXXX XXX X XXX X
X X X X     X   X     X     X   X   X
XXX XXX X XXXXX XXXXX XXX XXX XXXXX X
X     X X X     X X     X X   XGX X X
X X X X X XXX XXX XXX XXX X X X X X X
X X X X X                 X X X     X
XXX XXXXXXX X X XXXXX XXX X XXX XXXXX
X       X X X X     X   X     X X   X
XXXXX X X XXXXXXXXX XXXXXXXXXXX X XXX
X   X X           X X     X   X X   X
X XXX XXXXX XXXXXXXXX XXXXX X X XXX X
X X   X      X        X     X       X
X X X XXXXX XXX X X X X XXXXXXXXXXXXX
X X X   X     X X X X       X   X X X
X X XXX XXX X X X XXXXXXXXX XXX X X X
X X   X X   X X X   X X   X X X     X
X XXX XXX XXXXX XXX X X XXXXX X XXXXX
X       X   X     X X     X   X X   X
XXX X XXXXX XXXXX XXX XXX X XXX X XXX
X X X X X X X X     X X   X X   X X X
X X XXX X X X X XXXXXXXXX X X X X X X
X   X   X   XG                X     X
X X X X XXX XXX XXXXXXX XXX XXX XXX X
XGX X X       X   X       X   X X  SX
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX`;

document.getElementById('fileInput').addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => parseMaze(ev.target.result.trim().split('\n'));
  reader.readAsText(file);
});

document.getElementById('loadDefault').addEventListener('click', () => {
  parseMaze(defaultMazeText.trim().split('\n'));
});

function parseMaze(lines) {
  [height, width] = lines[0].split(' ').map(Number);
  maze = lines.slice(1).map(l => l.split(''));
  start = null; goals = [];
  for (let y = 0; y < height; y++)
    for (let x = 0; x < width; x++) {
      if (maze[y][x] === 'S') start = {x, y};
      if (maze[y][x] === 'G') goals.push({x, y});
    }
  resizeCanvas();
  drawMaze();
  document.getElementById('status').textContent = 'Maze loaded!';
}

function resizeCanvas() {
  canvas.width = width * cellSize;
  canvas.height = height * cellSize;
}

function drawMaze(numbers = {}) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let y = 0; y < height; y++)
    for (let x = 0; x < width; x++) {
      const ch = maze[y][x];
      if (ch === 'X') ctx.fillStyle = '#0b0c10';
      else if (ch === 'S') ctx.fillStyle = '#45a29e';
      else if (ch === 'G') ctx.fillStyle = '#ffdf6c';
      else ctx.fillStyle = '#1f2833';
      ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
      const key = `${x},${y}`;
      if (numbers[key] !== undefined) {
        ctx.fillStyle = '#fff';
        ctx.font = '10px monospace';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(numbers[key], x * cellSize + cellSize/2, y * cellSize + cellSize/2);
      }
    }
}

// === Direction order logic ===
let orderList = [];
const dirButtons = document.querySelectorAll('.dir-btn');

dirButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const dir = btn.dataset.dir;
    const index = orderList.indexOf(dir);
    if (index !== -1) {
      orderList.splice(index, 1);
    } else {
      orderList.push(dir);
    }
    updateDirButtons();
  });
});

function updateDirButtons() {
  dirButtons.forEach(btn => {
    const dir = btn.dataset.dir;
    const span = btn.querySelector('.dir-order');
    const idx = orderList.indexOf(dir);
    span.textContent = idx !== -1 ? idx + 1 : '';
  });
}

function getNeighbors(x, y, order) {
  const dirs = { U:[0,-1], D:[0,1], L:[-1,0], R:[1,0] };
  const res = [];
  for (let d of order) {
    const [dx, dy] = dirs[d] || [];
    if (dx === undefined) continue;
    const nx = x + dx, ny = y + dy;
    if (ny>=0 && ny<height && nx>=0 && nx<width && maze[ny][nx] !== 'X')
      res.push({x:nx, y:ny});
  }
  return res;
}

// === FIXED SEARCH FUNCTION ===
function search(type, order) {
  if (!start) {
    alert("No start point (S) found in maze!");
    return { found: false, steps: 0, visitedOrder: {} };
  }

  const frontier = [];
  const visited = new Set();
  const visitedOrder = {};
  let step = 0;
  let found = false;

  frontier.push({x: start.x, y: start.y});
  visited.add(`${start.x},${start.y}`);

  while (frontier.length > 0) {
    const current = type === 'bfs' ? frontier.shift() : frontier.pop();

    // Mark when expanded
    visitedOrder[`${current.x},${current.y}`] = step++;

    if (maze[current.y][current.x] === 'G') {
      found = true;
      break;
    }

    let neighbors = getNeighbors(current.x, current.y, order);
    if (type === 'dfs') neighbors = [...neighbors].reverse();

    for (let n of neighbors) {
      const key = `${n.x},${n.y}`;
      if (!visited.has(key)) {
        visited.add(key);
        frontier.push(n);
      }
    }
  }

  return { found, steps: step, visitedOrder };
}

// === Run button ===
document.getElementById('runBtn').addEventListener('click', () => {
  if (!maze.length) return alert('Load a maze first!');
  if (orderList.length === 0) return alert('Select neighbor order!');
  const algo = document.getElementById('algo').value;
  const result = search(algo, orderList);
  drawMaze(result.visitedOrder);
  document.getElementById('status').textContent =
    result.found ? `Goal reached in ${result.steps} steps!` : 'No goal found.';
});

// Auto-load default maze
window.addEventListener("load", () => {
  parseMaze(defaultMazeText.trim().split("\n"));
  updateDirButtons();
});
</script>
</body>
</html>

